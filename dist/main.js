(()=>{"use strict";function e(e){e.classList.add("popup_is-animated","popup_is-opened"),document.addEventListener("keydown",t)}function t(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?o:n}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var o=t.submitter,c=o.textContent;r(!0,o,c,n),e().then((function(){t.target.reset(),o.disabled=!0})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){r(!1,o,c)}))}var i={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-3",headers:{authorization:"397c7185-000a-4a1c-a6b0-631c387bbfc7","Content-Type":"application/json"}};function a(e,t){return fetch("".concat(i.baseUrl)+e,t).then(o)}var u=function(){return a("/cards",{headers:i.headers})},s=function(e,t){return a("/cards/likes/".concat(e),{method:t,headers:i.headers})},l=document.querySelector(".popup_type_image"),d=l.querySelector(".popup__image"),p=l.querySelector(".popup__caption");function f(t,o,r,c,i){var a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__image"),s=a.querySelector(".card__title"),f=a.querySelector(".card__like-button"),m=a.querySelector(".card__delete-button"),_=a.querySelector(".card__like-counter"),v=document.querySelector(".popup_type_delete-card"),y=v.querySelector(".popup__form");return u.setAttribute("src",t.link),u.setAttribute("alt",t.name),s.textContent=t.name,_.textContent=t.likes.length,t.likes.forEach((function(e){e._id==i&&f.classList.add("card__like-button_is-active")})),t.owner._id==i?m.addEventListener("click",(function(){e(v);var r=function(e){e.preventDefault(),o(a,t._id),n(e.target.closest(".popup"))};new Promise((function(e,t){var n=function n(o){o.target.classList.contains("button")?(v.removeEventListener("mousedown",n),document.removeEventListener("keydown",n),e()):(o.target.classList.contains("popup_type_delete-card")||o.target.classList.contains("popup__close")||"Escape"===o.key)&&(v.removeEventListener("mousedown",n),document.removeEventListener("keydown",n),t())};v.addEventListener("mousedown",n),document.addEventListener("keydown",n)})).then((function(){y.addEventListener("submit",r)})).catch((function(){y.removeEventListener("submit",r)}))})):m.remove(),f.addEventListener("click",(function(){return r(f,t._id)})),u.addEventListener("click",(function(){d.src=u.src,d.setAttribute("alt",s.textContent),p.textContent=s.textContent,c(l)})),a}function m(e,t){e.classList.contains("card__like-button_is-active")?s(t,"DELETE").then((function(t){e.classList.remove("card__like-button_is-active"),e.nextElementSibling.textContent=t.likes.length})).catch((function(e){console.log(e)})):s(t,"PUT").then((function(t){e.classList.add("card__like-button_is-active"),e.nextElementSibling.textContent=t.likes.length})).catch((function(e){console.log(e)}))}function _(e,t){(function(e){return a("/cards/".concat(e),{method:"DELETE",headers:i.headers})})(t).then(e.remove()).catch((function(e){console.log(e)}))}function v(e,t,n){t.querySelector(".".concat(n.id,"-error")).textContent="",n.classList.remove(e.errorClass)}function y(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.disabled=!1:n.disabled=!0}function h(e,t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){v(e,t,n)}))}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var S,g=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_edit-avatar"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),C=document.querySelector(".profile__image"),x=document.forms["edit-profile"],A=document.forms["new-place"],w=document.forms["edit-avatar"],T=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),O=document.querySelector(".places__list"),P=document.querySelectorAll(".popup"),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};P.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&n(e),t.target.classList.contains("popup__close")&&n(e)}))})),k.addEventListener("click",(function(){x.reset(),h(M,x),e(g),x.name.value=T.textContent,x.description.value=j.textContent})),q.addEventListener("click",(function(){A.reset(),h(M,A),e(E)})),C.addEventListener("click",(function(){w.reset(),h(M,L),e(L)})),w.addEventListener("submit",(function(e){c((function(){return(t=w.elements.link.value,a("/users/me/avatar",{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})})).then(C.style.backgroundImage="url(".concat(w.elements.link.value,")")).then(n(e.target.closest(".popup")));var t}),e)})),x.addEventListener("submit",(function(e){c((function(){return(t=x.name.value,o=x.description.value,a("/users/me",{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:o})})).then((function(e){T.textContent=e.name,j.textContent=e.about})).then(n(e.target.closest(".popup")));var t,o}),e)})),A.addEventListener("submit",(function(t){c((function(){return(o=A.elements["place-name"].value,r=A.elements.link.value,a("/cards",{method:"POST",headers:i.headers,body:JSON.stringify({name:o,link:r})})).then((function(){u().then((function(t){O.innerHTML="",t.forEach((function(t){var n=f(t,_,m,e,"bfb916be30e790576dcc2d84");O.append(n)}))}))})).then(n(t.target.closest(".popup")));var o,r}),t)})),S=M,Array.from(document.querySelectorAll(S.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);y(0,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?v(e,t,n):function(e,t,n,o){t.querySelector(".".concat(n.id,"-error")).textContent=o,n.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,r),y(0,n,o)}))}))}(S,e)})),Promise.all([a("/users/me",{headers:i.headers}),u()]).then((function(t){var n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,i,a=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(a.push(o.value),a.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw r}}return a}}(n,o)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],i=r[1];document.querySelector(".profile__title").textContent=c.name,document.querySelector(".profile__description").textContent=c.about,document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(c.avatar,")")),i.forEach((function(t){var n=f(t,_,m,e,c._id);O.append(n)}))})).catch((function(e){console.log(e)}))})();